{% extends 'layout.html' %}
{% load staticfiles bootstrap3 %}

{% block head_js_extra %}{{ block.super }}
<script src="{% static "jasmin_services/js/jquery.multi-select.js" %}" type="text/javascript"></script>
{% endblock %}

{% block stylesheets_extra %}{{ block.super }}
<link href="{% static "jasmin_services/css/multi-select.css" %}" media="screen" rel="stylesheet" type="text/css" />
{% endblock %}

{% block page_title %}Grant role{% endblock %}

{% block breadcrumbs %}
<ol class="breadcrumb">
    <li>JASMIN Services</li>
    <li>
        <a href="{% url 'jasmin_services:service_list' category=service.category.name %}">{{ service.category }}</a>
    </li>
    <li class="active">{{ service.name }}</li>
</ol>
{% endblock %}

{% block content_header %}{{ block.super }}
<div class="row">
    <div class="col-md-12">
        {% include "jasmin_services/includes/service_tabs.html" %}
    </div>
</div>
{% endblock %}

{% block content %}
<div class="col-md-8 col-md-offset-2">
    <div class="banner banner-info text-center">
        <p>You can use this form to grant a role to a specific user.</p>
    </div>
    <form method="POST" action="" class="form-horizontal" id="message-form">
        {% csrf_token %}

        {% bootstrap_form form layout='horizontal' %}

        <div class="form-group">
            <div class="col-sm-offset-3 col-sm-9">
                <button name="submitted" type="submit" class="btn btn-primary" autocomplete="off">Grant role</button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block footer_js %}
<script type="text/javascript">
    
    // Reset the hiding of form-groups except for those we are worried about
    $('.form-group').not(':has([name^="expires_custom"])').show();
    // Constants used in the function below
    var CUSTOM_DATE = '7';
    // This function makes sure only fields which are needed are shown
    var toggle_fields = function() {
        var expires = $('[name="expires"]').find('option:selected').val();
        var show_custom = ( expires == CUSTOM_DATE );
        $('[name="expires_custom"]').closest('.form-group')[show_custom ? 'show' : 'hide']();
    }
    toggle_fields();
    $('[name="expires"]').on('change', toggle_fields);

    // For date fields, replace the control with an input group
    $('input[type="date"]').each(function() {
        var $input = $(this);
        var $inputGroup = $('<div class="input-group"><span class="input-group-addon"><i class="fa fa-fw fa-calendar"></i></span></div>').insertBefore($input);
        $input.attr('type', 'text').detach().prependTo($inputGroup);
        $input.datepicker({
            'format' : 'yyyy-mm-dd',
            'startDate' : new Date(),
            'autoclose' : true
        });
    });

    
</script>
{% endblock %}
